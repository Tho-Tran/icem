<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Website Monitoring</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* C·∫≠p nh·∫≠t m√†u n·ªÅn c·ªßa .table-dark */
        .table-dark {
            --bs-table-bg: #079463 !important;
        }

        /* CƒÉn ch·ªânh icon v√† ti√™u ƒë·ªÅ */
        .title-container {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px; /* Kho·∫£ng c√°ch gi·ªØa icon v√† text */
        }

        .title-icon {
            height: 40px; /* ƒê·∫∑t chi·ªÅu cao icon */
            width: auto;
        }

        /* Ch·∫∑n xu·ªëng d√≤ng c·ªßa Server v√† Type */
        td {
            white-space: nowrap;
        }

        /* Cho ph√©p Error_Message xu·ªëng d√≤ng thay v√¨ k√©o ngang */
        .error-message {
            white-space: normal;
            word-wrap: break-word;
            max-width: 300px; /* Gi·ªõi h·∫°n chi·ªÅu r·ªông ƒë·ªÉ t·ª± ƒë·ªông xu·ªëng d√≤ng */
        }

        /* B·∫≠t thanh cu·ªôn ngang n·∫øu c·∫ßn */
        .table-responsive {
            overflow-x: auto;
        }
    </style>

    <script>
        function fetchStatus() {
            fetch("/status")
                .then(response => response.json())
                .then(data => {
                    let tableBody = "";
                    data.forEach((site, index) => {
                        let status = site.status === "OK"
                            ? "<span class='badge bg-success'>üü¢ OK</span>"
                            : "<span class='badge bg-danger'>üî¥ DOWN</span>";

                        let responseTime = site.response_time ? site.response_time + " ms" : "N/A";
                        let lastChecked = site.last_checked !== "N/A" ? site.last_checked : "Ch∆∞a ki·ªÉm tra";
                        let errorMessage = site.error_message !== "N/A" ? site.error_message : "-";

                        tableBody += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${site.server}</td>
                                <td>${site.type}</td>
	   			<td><a href="${site.url}" target="_blank">${site.url}</a></td>
                                <td>${status}</td>
                                <td>${responseTime}</td>
                                <td>${lastChecked}</td>
                                <td class="error-message">${errorMessage}</td>
                            </tr>
                        `;
                    });
                    document.getElementById("table-body").innerHTML = tableBody;
                })
                .catch(error => console.error("L·ªói t·∫£i d·ªØ li·ªáu:", error));
        }
        setInterval(fetchStatus, 10000); // C·∫≠p nh·∫≠t m·ªói 10 gi√¢y
        window.onload = fetchStatus;
    </script>
</head>
<body class="bg-light">
    <div class="container mt-5">
        <!-- Ti√™u ƒë·ªÅ v·ªõi icon -->
        <div class="title-container">
            <img src="https://icem.com.au/wp-content/uploads/2020/01/ICEM-logo.jpg-e1578902137843.jpg" 
                 alt="ICEM Logo" class="title-icon">
            <h2>üåç Website Monitoring</h2>
        </div>

        <div class="card shadow p-3 mt-4">
            <div class="table-responsive">
                <table class="table table-bordered table-hover">
                    <thead class="table-dark text-white">
                        <tr>
                            <th>No</th>
                            <th>Server</th>
                            <th>Type</th>
                            <th>Website</th>
                            <th>Status</th>
                            <th>Response Time</th>
                            <th>Last Checked</th>
                            <th>Error Message</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <tr><td colspan="8" class="text-center">loading...</td></tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

